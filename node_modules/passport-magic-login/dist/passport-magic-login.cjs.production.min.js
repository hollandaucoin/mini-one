"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,n=(e=require("jsonwebtoken"))&&"object"==typeof e&&"default"in e?e.default:e;function t(){return(t=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(this,arguments)}var o=function(e,t,o){return void 0===o&&(o={expiresIn:"60min"}),n.sign(t,e,o)};exports.default=function(){function e(e){var n=this;this._options=e,this.name="magiclogin",this.send=function(e,r){var i,s="GET"===e.method?e.query:e.body;if("POST"!==e.method||null!=(i=e.headers["content-type"])&&i.match("application/json"))if(s.destination){var a=Math.floor(9e4*Math.random())+1e4+"",c=o(n._options.secret,t({},s,{code:a}),n._options.jwtOptions);n._options.sendMagicLink(s.destination,n._options.callbackUrl+"?token="+c,a,e).then((function(){r.json({success:!0,code:a})})).catch((function(e){console.error(e),r.json({success:!1,error:e})}))}else r.status(400).send("Please specify the destination.");else r.status(400).send("Content-Type must be application/json when using POST method.")},this.confirm=function(e,t){console.warn("magicLink.confirm was removed in v1.0.7, it is no longer necessary."),t.redirect(n._options.callbackUrl+"?token="+e.query.token)}}return e.prototype.authenticate=function(e){var t=this,o=null;try{var r;o=function(e,t){if("string"!=typeof t)throw new Error("No token provided");return n.verify(t,e)}(t._options.secret,e.query.token||(null==(r=e.body)?void 0:r.token))}catch(e){var i=e instanceof Error?e.message:"No valid token provided";return t.fail(i)}t._options.verify(o,(function(e,n,o){return e?t.error(e):n?t.success(n,o):t.fail(o)}),e)},e}();
//# sourceMappingURL=passport-magic-login.cjs.production.min.js.map
